

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tracer Particles &mdash; Phoebus 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />

  
    <link rel="canonical" href="https://lanl.github.io/phoebus/src/tracers.html" />
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=8d563738"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=f281be69"></script>
      <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="How to Use Sphinx for Writing Docs" href="sphinx-doc.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Phoebus
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="building.html">Building</a></li>
<li class="toctree-l1"><a class="reference internal" href="code_of_conduct.html">Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="governance.html">Organizational Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="sphinx-doc.html">How to Use Sphinx for Writing Docs</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tracer Particles</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Phoebus</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Tracer Particles</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/src/tracers.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="tracer-particles">
<h1>Tracer Particles<a class="headerlink" href="#tracer-particles" title="Link to this heading"></a></h1>
<p><code class="docutils literal notranslate"><span class="pre">Phoebus</span></code> includes Lagrangian tracer particles.
These are primarily for the purpose of post-processing simulation data for, e.g., nucleosynthesis.
They are operator spit from the hydrodynamics and advected with a standard second order Runge-Kutta
integrator. As <code class="docutils literal notranslate"><span class="pre">Phoebus</span></code> is a general relativistic code, we evolve tracer positions using a
relativistic advection equation:</p>
<div class="math notranslate nohighlight">
\[\frac{dx^i}{dt} = \frac{u^i}{u^0} = \alpha v^i - \beta^i\]</div>
<p>Tracers may be enabled by in the <code class="docutils literal notranslate"><span class="pre">Phoebus</span></code> input deck as follow:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">physics</span><span class="o">&gt;</span>
<span class="n">tracers</span> <span class="o">=</span> <span class="n">true</span>

<span class="o">&lt;</span><span class="n">tracers</span><span class="o">&gt;</span>
<span class="n">num_tracers</span> <span class="o">=</span> <span class="mi">1024</span>
<span class="n">defrag_frac</span> <span class="o">=</span> <span class="mf">0.2</span>
</pre></div>
</div>
<p>Where <cite>&lt;physics&gt;/tracers = true</cite> enables tracer particles for applicable problems,
<cite>&lt;tracers&gt;/num_tracers</cite> sets the number of tracer particles (usually per block), if applicable,
and <cite>&lt;tracers&gt;/defrag_frac</cite> sets the fractional occupancy of tracer swarm containers.
.. note:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Particles typically loop from 0 to some `max_active_index`.
If only a small fraction of particles in that range are active, this
is inefficient. `Defrag` copies active particles to a contiguous range.
It can be inefficient, so should be done sparingly.
</pre></div>
</div>
<p>Similarly, tracers may be output by modifying an existing Parthenon output block, or creating a new one:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">parthenon</span><span class="o">/</span><span class="n">output1</span><span class="o">&gt;</span>
<span class="o">//</span> <span class="o">...</span>
<span class="n">swarms</span> <span class="o">=</span> <span class="n">tracers</span>
<span class="n">tracers_variables</span> <span class="o">=</span> <span class="n">rho</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">ye</span>

<span class="n">file_type</span> <span class="o">=</span> <span class="n">hdf5</span>
<span class="n">dt</span> <span class="o">=</span> <span class="o">//</span> <span class="n">output</span> <span class="n">cadence</span>
</pre></div>
</div>
<p>Note that the position variables x, y, z are output for all swarms by default.
See the <a class="reference external" href="parthenon-swarms">Parthenon docs</a> for more information.</p>
<p>Tracers must, however, be configured in the problem generator.
In the generator, the tracers should be distributed through the domain, assigned positions
and unique ids. An example from the advection pgen is shown below.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">pmb</span><span class="o">-&gt;</span><span class="n">par_for</span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;ProblemGenerator::Advection::DistributeTracers&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">max_active_index</span><span class="p">,</span>
<span class="w">    </span><span class="n">KOKKOS_LAMBDA</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">swarm_d</span><span class="p">.</span><span class="n">IsActive</span><span class="p">(</span><span class="n">n</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">rng_gen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rng_pool</span><span class="p">.</span><span class="n">get_state</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// sample in ball</span>
<span class="w">        </span><span class="n">Real</span><span class="w"> </span><span class="n">r2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rin</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rin</span><span class="p">;</span><span class="w"> </span><span class="c1">// init &gt; rin^2</span>
<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">r2</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">rin</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rin</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="n">x</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x_min</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rng_gen</span><span class="p">.</span><span class="n">drand</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">x_max</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x_min</span><span class="p">);</span>
<span class="w">          </span><span class="n">y</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y_min</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rng_gen</span><span class="p">.</span><span class="n">drand</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">y_max</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y_min</span><span class="p">);</span>
<span class="w">          </span><span class="n">z</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">z_min</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rng_gen</span><span class="p">.</span><span class="n">drand</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">z_max</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">z_min</span><span class="p">);</span>
<span class="w">          </span><span class="n">r2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">y</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">z</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">id</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">num_tracers_total</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">gid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>

<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">on_current_mesh_block</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="n">swarm_d</span><span class="p">.</span><span class="n">GetNeighborBlockIndex</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="n">y</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="n">z</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="n">on_current_mesh_block</span><span class="p">);</span>
<span class="w">        </span><span class="n">rng_pool</span><span class="p">.</span><span class="n">free_state</span><span class="p">(</span><span class="n">rng_gen</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
</pre></div>
</div>
<p>In addition to position, tracers track a number of potentially useful quantities.
These quantities include (bold quantities are 3-vectors with components _x, _y, _z)</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Quantity</p></th>
<th class="head"><p>SwarmVar Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Density</p></td>
<td><p>rho</p></td>
<td><p>Primitive density</p></td>
</tr>
<tr class="row-odd"><td><p>Temperature</p></td>
<td><p>temperature</p></td>
<td><p>Temperature</p></td>
</tr>
<tr class="row-even"><td><p>Ye</p></td>
<td><p>ye</p></td>
<td><p>Electron fraction (0 if ye is disabled)</p></td>
</tr>
<tr class="row-odd"><td><p>Internal energy</p></td>
<td><p>energy</p></td>
<td><p>Primitive internal energy</p></td>
</tr>
<tr class="row-even"><td><p>Entropy</p></td>
<td><p>entropy</p></td>
<td><p>Entropy</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Velocity</strong></p></td>
<td><p>vel_x, …</p></td>
<td><p>Three velocity</p></td>
</tr>
<tr class="row-even"><td><p>Lorentz factor</p></td>
<td><p>lorentz</p></td>
<td><p>Relativistic Lorentz factor</p></td>
</tr>
<tr class="row-odd"><td><p>Lapse</p></td>
<td><p>lapse</p></td>
<td><p>Relativistic lapse</p></td>
</tr>
<tr class="row-even"><td><p>Metric determinant</p></td>
<td><p>detgamma</p></td>
<td><p>Spatial metric determinant</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Shift</strong></p></td>
<td><p>shift_x, …</p></td>
<td><p>Relativistic shift</p></td>
</tr>
<tr class="row-even"><td><p>Mass</p></td>
<td><p>mass</p></td>
<td><p>Tracer mass</p></td>
</tr>
<tr class="row-odd"><td><p>Total energy</p></td>
<td><p>bernoulli</p></td>
<td><p>Total energy Bernoulli quantity</p></td>
</tr>
<tr class="row-even"><td><p><strong>Magnetic field</strong></p></td>
<td><p>B_x, …</p></td>
<td><p>Primitive 3-magnetic field components (if mhd enabled)</p></td>
</tr>
</tbody>
</table>
<p>To minimize unnecessary work, these quantities are only populated before output using <code class="docutils literal notranslate"><span class="pre">phoebus::UserWorkBeforeOutput</span></code>.</p>
<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv420UserWorkBeforeOutputP9MeshBlockP14ParameterInput">
<span id="_CPPv320UserWorkBeforeOutputP9MeshBlockP14ParameterInput"></span><span id="_CPPv220UserWorkBeforeOutputP9MeshBlockP14ParameterInput"></span><span id="UserWorkBeforeOutput__MeshBlockP.ParameterInputP"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">UserWorkBeforeOutput</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">MeshBlock</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n sig-param"><span class="pre">pmb</span></span>, <span class="n"><span class="pre">ParameterInput</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n sig-param"><span class="pre">pin</span></span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv420UserWorkBeforeOutputP9MeshBlockP14ParameterInput" title="Link to this definition"></a><br /></dt>
<dd><p>Describes work to be done prior to HDF5 output, such as populating tracer variables.
This is connected to the appropriate Parthenon function.</p>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="sphinx-doc.html" class="btn btn-neutral float-left" title="How to Use Sphinx for Writing Docs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Triad National Security.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: blb/sparsepacks
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Branches</dt>
      <dd><a href="../../../main/src/tracers.html">main</a></dd>
      <dd><a href="../../../adi_test/src/tracers.html">adi_test</a></dd>
      <dd><a href="../../../adithan/MLED/src/tracers.html">adithan/MLED</a></dd>
      <dd><a href="../../mc_on_meshdata/src/tracers.html">blb/mc_on_meshdata</a></dd>
      <dd><a href="tracers.html">blb/sparsepacks</a></dd>
      <dd><a href="../../../jwm/TOV3D/src/tracers.html">jwm/TOV3D</a></dd>
      <dd><a href="../../../jwm/TovOnPolaris/src/tracers.html">jwm/TovOnPolaris</a></dd>
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>